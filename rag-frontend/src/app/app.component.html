<div class="chat-container">
  <!-- Header -->
  <mat-toolbar color="primary">
    <span>PLA Chat Assistant</span>
    <span class="spacer"></span>
    <mat-icon>chat</mat-icon>
  </mat-toolbar>

  <div class="main-content">
    <!-- Sidebar with parameters -->
    <div class="sidebar">
      <div class="parameters-section">
        <h3>Configuration</h3>

        <mat-form-field appearance="outline">
          <mat-label>Model</mat-label>
          <mat-select [(value)]="parameters.model">
            <mat-option value="gpt-4o-mini">GPT-4o Mini</mat-option>
            <mat-option value="grok-3">Grok-3</mat-option>
            <mat-option value="DeepSeek-R1">DeepSeek-R1</mat-option>
            <mat-option value="gpt-4o">GPT-4o</mat-option>
          </mat-select>
        </mat-form-field>

        <div class="temperature-control">
          <label class="temperature-label"
            >Temperature: {{ parameters.temperature }}</label
          >
          <input
            type="range"
            min="0"
            max="1"
            step="0.1"
            [(ngModel)]="parameters.temperature"
            class="temperature-slider"
          />
          <div class="range-labels">
            <span>0.0</span>
            <span>1.0</span>
          </div>
        </div>

        <mat-form-field appearance="outline">
          <mat-label>Context</mat-label>
          <textarea
            matInput
            [(ngModel)]="parameters.context"
            rows="4"
            placeholder="Enter additional context for the AI..."
          >
          </textarea>
        </mat-form-field>

        <button mat-raised-button color="accent" (click)="clearChat()">
          <mat-icon>clear</mat-icon>
          Clear Chat
        </button>
      </div>
    </div>

    <!-- Chat area -->
    <div class="chat-area">
      <div class="messages-container" #messagesContainer>
        <div *ngIf="messages.length === 0" class="no-messages">
          <p>
            Welcome! Ask me anything and I'll help you find information using
            RAG.
          </p>
        </div>

        <div
          *ngFor="let message of messages"
          class="message"
          [class.user-message]="message.isUser"
          [class.assistant-message]="!message.isUser"
        >
          <div [innerHTML]="message.content"></div>

          <div
            *ngIf="message.sources && message.sources.length > 0"
            class="sources"
          >
            <strong>Sources:</strong>
            <div *ngFor="let source of message.sources" class="source-item">
              <strong>{{ source.title }}</strong> (Score:
              {{ source.score | number : "1.2-2" }})
              <br />
              <small>{{ source.content }}</small>
            </div>
          </div>

          <div class="timestamp">
            {{ message.timestamp | date : "short" }}
          </div>
        </div>

        <div *ngIf="isLoading" class="loading message assistant-message">
          <mat-spinner diameter="20"></mat-spinner>
          <span>Thinking...</span>
        </div>
      </div>

      <!-- Input area -->
      <div class="input-area">
        <div style="display: flex; align-items: center">
          <mat-form-field appearance="outline" style="flex: 1">
            <mat-label>Type your question...</mat-label>
            <input
              matInput
              [(ngModel)]="currentMessage"
              (keyup.enter)="sendMessage()"
              [disabled]="isLoading"
              placeholder="What would you like to know?"
            />
          </mat-form-field>

          <button
            mat-fab
            color="primary"
            class="send-button"
            (click)="sendMessage()"
            [disabled]="!currentMessage.trim() || isLoading"
          >
            <mat-icon>send</mat-icon>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
